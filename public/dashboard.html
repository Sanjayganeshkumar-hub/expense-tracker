<!DOCTYPE html>
<html>
<head>
  <title>Expense Tracker</title>
  <style>
    body {
      font-family: Arial;
      background: #fff4ee;
    }
    .box {
      background: white;
      padding: 20px;
      margin: 20px;
      border-radius: 10px;
    }
    button {
      background: #ff5b4d;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
    }
    .delete-btn {
      background: #333;
      margin-left: 10px;
    }
  </style>
</head>
<body>

<h1>Expense Tracker</h1>

<div class="box">
  <h3>Total Income: ₹<span id="income">0</span></h3>
  <h3>Total Expense: ₹<span id="expense">0</span></h3>
  <h3>Balance: ₹<span id="balance">0</span></h3>
</div>

<div class="box">
  <h3>Add Transaction</h3>
  <select id="type">
    <option value="income">Income</option>
    <option value="expense">Expense</option>
  </select>
  <input id="amount" placeholder="Amount">
  <input id="category" placeholder="Category">
  <input id="description" placeholder="Description">
  <button onclick="addTransaction()">Add Transaction</button>
</div>

<div class="box">
  <h3>Recent Transactions</h3>
  <ul id="list"></ul>
</div>

<script>
const userId = localStorage.getItem("userId");
if (!userId) location.href = "/";

async function loadTransactions() {
  const res = await fetch(`/transactions/${userId}`);
  const data = await res.json();

  let income = 0, expense = 0;
  const list = document.getElementById("list");
  list.innerHTML = "";

  data.forEach(t => {
    if (t.type === "income") income += t.amount;
    else expense += t.amount;

    const li = document.createElement("li");
    li.innerHTML = `
      ${t.type} - ₹${t.amount} (${t.category})
      <button class="delete-btn" onclick="deleteTxn('${t._id}')">Delete</button>
    `;
    list.appendChild(li);
  });

  document.getElementById("income").innerText = income;
  document.getElementById("expense").innerText = expense;
  document.getElementById("balance").innerText = income - expense;
}

async function addTransaction() {
  await fetch("/transaction", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      userId,
      type: type.value,
      amount: Number(amount.value),
      category: category.value,
      description: description.value
    })
  });
  loadTransactions();
}

async function deleteTxn(id) {
  await fetch(`/transaction/${id}`, { method: "DELETE" });
  loadTransactions();
}

loadTransactions();
</script>

</body>
</html>
