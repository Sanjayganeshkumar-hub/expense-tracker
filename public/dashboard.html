<!DOCTYPE html>
<html>
<head>
  <title>Expense Tracker</title>
  <style>
    body { font-family: Arial; background:#6b6bd6; padding:20px }
    input, select, button { padding:8px; margin:5px }
    .box { background:#fff; padding:20px; margin:10px 0 }
  </style>
</head>
<body>

<h1>Expense Tracker</h1>
<button onclick="logout()">Logout</button>

<div class="box">
  <h3>Total Income: ₹<span id="income">0</span></h3>
  <h3>Total Expense: ₹<span id="expense">0</span></h3>
  <h3>Balance: ₹<span id="balance">0</span></h3>
</div>

<div class="box">
  <h3>Add Transaction</h3>
  <select id="type">
    <option value="income">Income</option>
    <option value="expense">Expense</option>
  </select>
  <input id="amount" type="number" placeholder="Amount">
  <input id="category" placeholder="Category">
  <input id="description" placeholder="Description">
  <button onclick="addTransaction()">Add</button>
</div>

<div class="box">
  <h3>Recent Transactions</h3>
  <ul id="list"></ul>
</div>

<script>
async function loadData() {
  const res = await fetch("/transactions");
  const data = await res.json();

  let income = 0, expense = 0;
  document.getElementById("list").innerHTML = "";

  data.forEach(t => {
    if (t.type === "income") income += t.amount;
    else expense += t.amount;

    document.getElementById("list").innerHTML +=
      `<li>${t.type} - ₹${t.amount} (${t.category})</li>`;
  });

  document.getElementById("income").innerText = income;
  document.getElementById("expense").innerText = expense;
  document.getElementById("balance").innerText = income - expense;
}

async function addTransaction() {
  await fetch("/transaction", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      type: type.value,
      amount: Number(amount.value),
      category: category.value,
      description: description.value
    })
  });
  loadData();
}

async function logout() {
  await fetch("/logout", { method: "POST" });
  location.href = "/";
}

loadData();
</script>

</body>
</html>
