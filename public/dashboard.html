<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard | Expense Tracker</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header>Expense Tracker</header>

<button class="logout" onclick="logout()">Logout</button>

<div class="card">
  <div class="stats">
    <div class="stat income">
      <h3>Total Income</h3>
      ₹<span id="income">0</span>
    </div>
    <div class="stat expense">
      <h3>Total Expense</h3>
      ₹<span id="expense">0</span>
    </div>
    <div class="stat balance">
      <h3>Balance</h3>
      ₹<span id="balance">0</span>
    </div>
  </div>
</div>

<div class="card">
  <h3>Add Transaction</h3>

  <select id="type">
    <option value="income">Income</option>
    <option value="expense">Expense</option>
  </select>

  <input type="number" id="amount" placeholder="Amount">
  <input type="text" id="category" placeholder="Category">
  <input type="text" id="description" placeholder="Description">

  <button onclick="addTransaction()">Add Transaction</button>
</div>

<div class="card">
  <h3>Recent Transactions</h3>
  <ul id="transactions"></ul>
</div>

<script>
const userId = localStorage.getItem("userId");
if (!userId) {
  alert("Session expired. Please login again.");
  window.location.href = "/";
}

async function loadTransactions() {
  const res = await fetch(`/transactions/${userId}`);
  const data = await res.json();

  let income = 0, expense = 0;
  const list = document.getElementById("transactions");
  list.innerHTML = "";

  data.forEach(t => {
    const li = document.createElement("li");
    li.innerHTML = `${t.type} - ₹${t.amount} (${t.category})`;

    list.appendChild(li);

    if (t.type === "income") income += t.amount;
    else expense += t.amount;
  });

  document.getElementById("income").innerText = income;
  document.getElementById("expense").innerText = expense;
  document.getElementById("balance").innerText = income - expense;
}

async function addTransaction() {
  const type = document.getElementById("type").value;
  const amount = Number(document.getElementById("amount").value);
  const category = document.getElementById("category").value;
  const description = document.getElementById("description").value;

  await fetch("/transaction", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ userId, type, amount, category, description })
  });

  loadTransactions();
}

function logout() {
  localStorage.removeItem("userId");
  window.location.href = "/";
}

loadTransactions();
</script>

</body>
</html>
