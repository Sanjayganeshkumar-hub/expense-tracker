<!DOCTYPE html>
<html>
<head>
  <title>Expense Tracker</title>
</head>
<body>

<h2>Expense Tracker</h2>
<button onclick="logout()">Logout</button>

<h3>Total Income: ₹<span id="income">0</span></h3>
<h3>Total Expense: ₹<span id="expense">0</span></h3>
<h3>Balance: ₹<span id="balance">0</span></h3>

<hr>

<h3>Add Transaction</h3>
<select id="type">
  <option value="income">Income</option>
  <option value="expense">Expense</option>
</select>
<input id="amount" type="number" placeholder="Amount">
<input id="category" placeholder="Category">
<input id="description" placeholder="Description">
<button onclick="addTransaction()">Add</button>

<hr>

<h3>Recent Transactions</h3>
<ul id="list"></ul>

<script>
async function loadTransactions() {
  const res = await fetch("/transactions");
  if (!res.ok) return;

  const data = await res.json();

  let income = 0, expense = 0;
  const list = document.getElementById("list");
  list.innerHTML = "";

  data.forEach(t => {
    if (t.type === "income") income += t.amount;
    else expense += t.amount;

    const li = document.createElement("li");
    li.textContent = `${t.type.toUpperCase()} - ₹${t.amount} (${t.category})`;
    list.appendChild(li);
  });

  document.getElementById("income").textContent = income;
  document.getElementById("expense").textContent = expense;
  document.getElementById("balance").textContent = income - expense;
}

async function addTransaction() {
  const body = {
    type: type.value,
    amount: Number(amount.value),
    category: category.value,
    description: description.value
  };

  await fetch("/transaction", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(body)
  });

  amount.value = category.value = description.value = "";
  loadTransactions();
}

function logout() {
  window.location.href = "/logout";
}

loadTransactions();
</script>

</body>
</html>
